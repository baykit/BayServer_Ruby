# TypeProf 0.21.11

# Classes
module Baykit
  module BayServer
    module Agent
      module Multiplexer
        class SpinMultiplexer
          @spin_count: Integer
          @running_list: Array[Lapper]
          @running_list_lock: Thread::Mutex
          @agent: GrandAgent

          def initialize: (GrandAgent agt) -> void
          def to_s: -> String
          def req_accept: (Rudders::Rudder rd) -> void
          def req_connect: (Rudders::Rudder rd, Addrinfo adr) -> void
          def req_read: (Rudders::Rudder rd) -> void
          def req_write: (Rudders::Rudder rd, String buf, Addrinfo adr, Object tag) { () -> void } -> void
          def req_end: (Rudders::Rudder rd) -> void
          def req_close: (Rudders::Rudder rd) -> void
          def shutdown: -> void
          def is_non_blocking: -> bool
          def use_async_api: -> bool
          def cancel_read: (Common::RudderState st) -> void
          def cancel_write: (Common::RudderState st) -> void
          def next_accept: (Common::RudderState st) -> void
          def next_read: (Common::RudderState st) -> void
          def next_write: (Common::RudderState st) -> void

          def on_busy: -> void
          def on_free: -> void
          def close_rudder: (Common::RudderState st) -> void
          def on_timer: -> void
          def is_empty: -> bool
          def process_data: -> bool

          private
          def remove_from_running_list: (Rudders::Rudder rd) -> void
          def add_to_running_list: (Lapper lpr) -> void

          class Lapper
            @multiplexer: Common::Multiplexer
            @state_id: Integer
            @state: Common::RudderState
            @last_access: Integer

            def initialize: (Common::Multiplexer mpx, Common::RudderState state) -> void
            def access: () -> void
            def lap: () -> bool
            def next: () -> void
          end

          class ReadIOLapper < Lapper
            @agent: GrandAgent

            def initialize: (Common::Multiplexer mpx, GrandAgent agt, Common::RudderState st) -> void
            def lap: -> bool
            def next: -> nil
          end
        end
      end
    end
  end
end
